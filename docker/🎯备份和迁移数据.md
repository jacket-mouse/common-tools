# ğŸ¯å¤‡ä»½å’Œè¿ç§»æ•°æ®

### è¿ç§»æ–¹å¼ä»‹ç»

å®¹å™¨ä¸­çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ç”¨æŒ‚è½½ç›®å½•ï¼Œåˆ é™¤å®¹å™¨åå°±ä¼šä¸¢å¤±æ•°æ®ã€‚
å‰é¢æˆ‘ä»¬å·²ç»è®²è§£äº†å¦‚ä½• [æŒ‚è½½ç›®å½•](doc:kze7f0ZR)
å¦‚æœä½ æ˜¯ç”¨`bind mount`ç›´æ¥æŠŠå®¿ä¸»æœºçš„ç›®å½•æŒ‚è¿›å»å®¹å™¨ï¼Œé‚£è¿ç§»æ•°æ®å¾ˆæ–¹ä¾¿ï¼Œç›´æ¥å¤åˆ¶ç›®å½•å°±å¥½äº†
å¦‚æœä½ æ˜¯ç”¨`volume`æ–¹å¼æŒ‚è½½çš„ï¼Œç”±äºæ•°æ®æ˜¯ç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†çš„ï¼Œéœ€è¦ç”¨ç‰¹æ®Šçš„æ–¹å¼æŠŠæ•°æ®å¼„å‡ºæ¥ã€‚

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=8)

### å¤‡ä»½å’Œå¯¼å…¥ Volume çš„æµç¨‹

å¤‡ä»½ï¼š

- è¿è¡Œä¸€ä¸ª ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½éœ€è¦å¤‡ä»½çš„ volume åˆ°å®¹å™¨ï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨é‡Œçš„å¤‡ä»½ç›®å½•ã€‚
- è¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®å‹ç¼©ä¸ºä¸€ä¸ªæ–‡ä»¶
- æŠŠå¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°éœ€è¦å¯¼å…¥çš„æœºå™¨

å¯¼å…¥ï¼š

- è¿è¡Œ ubuntu å®¹å™¨ï¼ŒæŒ‚è½½å®¹å™¨çš„ volumeï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºå¤‡ä»½æ–‡ä»¶æ‰€åœ¨ç›®å½•åˆ°å®¹å™¨é‡Œ
- è¿è¡Œ tar å‘½ä»¤è§£å‹å¤‡ä»½æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•

### å¤‡ä»½ MongoDB æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª mongodbï¼Œåˆ›å»ºä¸€ä¸ªåå«`mongo-data`çš„ volume æŒ‡å‘å®¹å™¨çš„ /data ç›®å½•
  `docker run -p 27018:27017 --name mongo -v mongo-data:/data -d mongo:4.4`
- è¿è¡Œä¸€ä¸ª Ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½`mongo`å®¹å™¨çš„æ‰€æœ‰ volumeï¼Œæ˜ å°„å®¿ä¸»æœºçš„ backup ç›®å½•åˆ°å®¹å™¨é‡Œé¢çš„ /backup ç›®å½•ï¼Œç„¶åè¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®å‹ç¼©æ‰“åŒ…
  `docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu tar cvf /backup/backup.tar /data/`

æœ€åä½ å°±å¯ä»¥æ‹¿ç€è¿™ä¸ª backup.tar æ–‡ä»¶å»å…¶ä»–åœ°æ–¹å¯¼å…¥äº†ã€‚

### æ¢å¤ Volume æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª ubuntu å®¹å™¨ï¼ŒæŒ‚è½½ mongo å®¹å™¨çš„æ‰€æœ‰ volumesï¼Œç„¶åè¯»å– /backup ç›®å½•ä¸­çš„å¤‡ä»½æ–‡ä»¶ï¼Œè§£å‹åˆ° /data/ ç›®å½•
  `docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu bash -c "cd /data/ && tar xvf /backup/backup.tar --strip 1"`

> æ³¨æ„ï¼Œvolumes-from æŒ‡å®šçš„æ˜¯å®¹å™¨åå­—
> strip 1 è¡¨ç¤ºè§£å‹æ—¶å»æ‰å‰é¢1å±‚ç›®å½•ï¼Œå› ä¸ºå‹ç¼©æ—¶åŒ…å«äº†ç»å¯¹è·¯å¾„

------

> è§‰å¾—è€å¸ˆè®²å¾—ä¸é”™çš„è¯ï¼Œè®°å¾—ç‚¹èµã€å…³æ³¨ã€åˆ†äº«ï¼Œé¼“åŠ±ä¸‹è€å¸ˆ
> ä½ ä»¬çš„é¼“åŠ±ä¼šè®©è€å¸ˆæ›´åŠ æœ‰åŠ¨åŠ›ç»§ç»­åˆ›é€ æ›´å¤šæ›´å¥½çš„å†…å®¹

ä½ å¯ä»¥åˆ° [Github issue](https://github.com/gzyunke/test-docker/issues) ç»™æˆ‘æé—®æˆ–åé¦ˆé‡åˆ°çš„é—®é¢˜ã€‚